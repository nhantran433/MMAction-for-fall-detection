urls = [
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-01-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-01-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-02-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-03-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-03-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-04-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-04-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-05-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-05-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-06-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-06-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-07-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-07-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-08-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-08-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-09-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-09-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-10-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-10-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-11-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-11-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-12-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-12-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-13-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-13-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-14-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-14-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-15-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-15-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-16-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-16-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-17-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-17-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-18-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-18-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-19-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-19-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-20-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-20-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-21-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-21-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-22-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-22-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-23-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-23-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-24-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-24-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-25-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-25-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-26-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-26-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-27-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-27-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-28-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-28-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-29-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-29-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-30-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-30-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-01-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-02-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-03-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-04-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-05-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-06-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-07-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-08-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-09-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-10-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-11-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-12-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-13-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-14-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-15-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-16-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-17-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-18-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-19-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-20-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-21-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-22-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-23-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-24-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-25-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-26-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-27-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-28-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-29-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-30-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-31-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-32-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-33-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-34-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-35-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-36-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-37-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-38-cam0-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-39-cam0-rgb.zip"
]
val_urls = [
    "http://fenix.ur.edu.pl/~mkepski/ds/data/fall-02-cam1-rgb.zip",
    "http://fenix.ur.edu.pl/~mkepski/ds/data/adl-40-cam0-rgb.zip"
]
import os, threading, sys, uuid, cv2, numpy as np
import urllib.request
import zipfile

fourcc = cv2.VideoWriter_fourcc(*'mp4v')
def images_to_video(file_named, is_val, frames, is_fall):
    if is_val:
        out = cv2.VideoWriter(f'datasets/val/{file_named}.mp4', fourcc, 40, (640, 480))
    else :
        out = cv2.VideoWriter(f'datasets/train/{file_named}.mp4', fourcc, 40, (640, 480))
    for frame in frames:
        cv2.resize(frame, (640, 480))
        out.write(frame)
    if not is_val:
        with open(f"datasets/train_label.txt", "a") as f:
            f.write(f"{file_named}.mp4 {is_fall}\n")
    else:
        with open(f"datasets/val_label.txt", "a") as f:
            f.write(f"{file_named}.mp4 {is_fall}\n")
    out.release()

def download(url, is_val):
    print("Downloading: " + url)
    file_named = str(uuid.uuid4())
    filename = f"temp_datasets/{file_named}.zip"
    urllib.request.urlretrieve(url, filename)
    print("Unzipping: " + filename)
    frames = []
    is_fall = False
    with zipfile.ZipFile(filename, 'r') as zip_ref:
        nof = 0
        for file_info in zip_ref.infolist():
            if nof == 0:
                nof += 1
                continue
            if file_info.filename.find("fall") != -1:
                is_fall = True
            with zip_ref.open(file_info.filename) as file:
                file_bytes = file.read()
                np_array = np.frombuffer(file_bytes, dtype=np.uint8)
                frames.append(cv2.imdecode(np_array, cv2.IMREAD_UNCHANGED)) 
    
    images_to_video(file_named, is_val, frames, is_fall)
    print("Removing: " + filename)
    os.remove(filename)
    
number_of_val_count = 0
threads = []
for url in urls:
    threads.append(threading.Thread(target=download, args=(url, False)))
for url in val_urls:
    threads.append(threading.Thread(target=download, args=(url, True)))

for thread in threads:
    thread.start()